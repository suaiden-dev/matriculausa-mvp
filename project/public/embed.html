<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amatricula USA Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'bounce': 'bounce 1s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .embed-container {
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="embed-root" class="embed-container">
        <!-- O componente React ser√° renderizado aqui -->
    </div>

    <script type="module">
        // Configura√ß√£o do embed
        const embedConfig = {
            agentId: new URLSearchParams(window.location.search).get('agentId') || null,
            agentName: new URLSearchParams(window.location.search).get('agentName') || 'AI Assistant',
            companyName: new URLSearchParams(window.location.search).get('companyName') || 'Amatricula USA',
            primaryColor: new URLSearchParams(window.location.search).get('primaryColor') || '#3B82F6',
            secondaryColor: new URLSearchParams(window.location.search).get('secondaryColor') || '#1E40AF'
        };

        // Fun√ß√£o para enviar mensagem para o site pai
        function sendMessageToParent(message) {
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'CHAT_MESSAGE',
                    data: message
                }, '*');
            }
        }

        // Fun√ß√£o para receber mensagens do site pai
        function handleParentMessage(event) {
            console.log('üéØ [embed.html] ===== MENSAGEM RECEBIDA DO PAI =====');
            console.log('üéØ [embed.html] Vers√£o atualizada do embed.html carregada!');
            console.log('[embed.html] Mensagem recebida do pai:', event.data);
            if (event.data && event.data.type === 'CHAT_RESPONSE') {
                // Processar resposta do chat
                console.log('‚úÖ [embed.html] Received chat response:', event.data);
                if (event.data.response) {
                    console.log('‚úÖ [embed.html] Adicionando mensagem do bot:', event.data.response);
                    addMessage(event.data.response, true);
                } else {
                    console.warn('‚ö†Ô∏è [embed.html] Resposta sem conte√∫do:', event.data);
                }
            }
        }

        // Adicionar listener para mensagens do pai
        window.addEventListener('message', handleParentMessage);

        // Simular o componente de chat (em produ√ß√£o, isso seria um React component)
        function createEmbedChat() {
            const container = document.getElementById('embed-root');
            
            // Criar interface do chat
            container.innerHTML = `
                <div class="bg-white rounded-3xl shadow-2xl border border-gray-100 w-full h-full flex flex-col overflow-hidden">
                    <!-- Header -->
                    <div class="text-white p-6 rounded-t-3xl flex justify-between items-center relative overflow-hidden" 
                         style="background: linear-gradient(135deg, ${embedConfig.primaryColor} 0%, ${embedConfig.secondaryColor} 100%)">
                        <div class="flex items-center gap-4 relative z-10">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-white/20">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-white text-xl">${embedConfig.agentName}</h3>
                                <p class="text-white/90 text-sm font-medium">${embedConfig.companyName}</p>
                            </div>
                        </div>
                        <button class="text-white/80 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10" 
                                title="Close chat" onclick="closeChat()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Messages -->
                    <div id="messages-container" class="flex-1 p-6 overflow-y-auto space-y-4 bg-gradient-to-b from-gray-50 to-white">
                        <div class="animate-fade-in">
                            <div class="flex justify-start">
                                <div class="max-w-[280px] px-5 py-4 rounded-2xl shadow-sm bg-white text-gray-800 border border-gray-100">
                                    <p class="text-sm leading-relaxed">Hi! I'm ${embedConfig.agentName} from ${embedConfig.companyName}. How can I help you today?</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Input -->
                    <div class="p-6 border-t border-gray-100 bg-white">
                        <div class="flex gap-3">
                            <div class="flex-1 relative">
                                <input type="text" id="message-input" 
                                       placeholder="Type your message here..." 
                                       class="w-full px-5 py-4 bg-gray-50 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:border-transparent text-sm transition-all duration-200"
                                       style="--tw-ring-color: ${embedConfig.primaryColor}; --tw-ring-opacity: 0.5"
                                       onkeypress="handleKeyPress(event)">
                            </div>
                            <button onclick="sendMessage()" 
                                    class="text-white p-4 rounded-2xl hover:shadow-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105 active:scale-95"
                                    style="background: linear-gradient(135deg, ${embedConfig.primaryColor} 0%, ${embedConfig.secondaryColor} 100%)"
                                    title="Send message">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- Footer -->
                        <div class="text-center mt-4">
                            <p class="text-xs text-gray-400 flex items-center justify-center gap-1">
                                <svg class="w-3 h-3" style="color: ${embedConfig.primaryColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                Powered by <a href="#" class="font-medium" style="color: ${embedConfig.primaryColor}">Amatricula USA</a>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fun√ß√µes do chat
        window.sendMessage = function() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, false);
                sendMessageToParent({
                    type: 'USER_MESSAGE',
                    message: message,
                    agentId: embedConfig.agentId,
                    agentName: embedConfig.agentName,
                    companyName: embedConfig.companyName
                });
                input.value = '';
            }
        };

        window.handleKeyPress = function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        };

        window.closeChat = function() {
            sendMessageToParent({
                type: 'CLOSE_CHAT'
            });
        };

        function addMessage(text, isBot = true) {
            console.log('üí¨ [embed.html] addMessage chamada:', { text, isBot });
            const container = document.getElementById('messages-container');
            if (!container) {
                console.error('‚ùå [embed.html] Container de mensagens n√£o encontrado');
                return;
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'animate-fade-in';
            
            const alignment = isBot ? 'justify-start' : 'justify-end';
            const bgColor = isBot ? 'bg-white text-gray-800 border border-gray-100' : 'text-white';
            const gradient = isBot ? '' : `style="background: linear-gradient(135deg, ${embedConfig.primaryColor} 0%, ${embedConfig.secondaryColor} 100%)"`;
            
            messageDiv.innerHTML = `
                <div class="flex ${alignment}">
                    <div class="max-w-[280px] px-5 py-4 rounded-2xl shadow-sm ${bgColor}" ${gradient}>
                        <p class="text-sm leading-relaxed">${text}</p>
                    </div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            console.log('‚úÖ [embed.html] Mensagem adicionada com sucesso:', text);
        }

        // Inicializar o chat
        createEmbedChat();

        // Notificar o site pai que o chat est√° pronto
        sendMessageToParent({
            type: 'CHAT_READY',
            config: embedConfig
        });
    </script>
</body>
</html> 